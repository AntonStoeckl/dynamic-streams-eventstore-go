# PostgreSQL 17.5 Configuration for EventStore Testing
# Optimized for development testing with limited memory usage (2GB allocation)

# Connection Settings
listen_addresses = '*'                   # Listen on all addresses (required for Docker)
max_connections = 100                    # Default

# Memory Settings (scaled down for 2GB allocation)
shared_buffers = 512MB                   # 25% of 2GB allocation
effective_cache_size = 1200MB            # 60% of 2GB allocation  
work_mem = 32MB                          # Reduced from 128MB for test workload
maintenance_work_mem = 128MB             # Reduced from 512MB for maintenance ops

# WAL (Write-Ahead Logging) Settings for Test Throughput
wal_level = replica                      # Enable replication support (may be needed for tests)
wal_buffers = 16MB                       # Reduced from 64MB
max_wal_size = 512MB                     # Scaled down from 2GB (1/4 scale)
min_wal_size = 128MB                     # Scaled down from 512MB
checkpoint_completion_target = 0.9       # Keep same ratio
wal_compression = on                     # Keep compression enabled

# Autovacuum Settings - Moderate for Test Environment
autovacuum = on
autovacuum_max_workers = 2               # Reduced from 4 for test workload
autovacuum_naptime = 60s                 # Keep same frequency

# Statistics Settings - Reduced for Test Environment
default_statistics_target = 500          # Reduced from 1000 for faster planning
track_counts = on                        # Required for autovacuum
track_functions = all                    # Track function calls

# JSONB and GIN Index Settings
effective_io_concurrency = 4             # Keep same for SSD storage

# Query Planner Settings
random_page_cost = 1.1                   # Keep same for SSD
seq_page_cost = 1.0                      # Sequential read cost
cpu_tuple_cost = 0.01                    # CPU cost per tuple
cpu_index_tuple_cost = 0.005             # CPU cost per index tuple
cpu_operator_cost = 0.0025               # CPU cost per operator

# Connection and Lock Settings (relaxed for testing)
deadlock_timeout = 1s
lock_timeout = 10s                       # Increased from 5s for test stability
statement_timeout = 60s                  # Increased from 30s for test stability

# Background Writer Settings (scaled down)
bgwriter_delay = 100ms                   # Increased from 50ms
bgwriter_lru_maxpages = 500              # Reduced from 1000
bgwriter_lru_multiplier = 5.0            # Reduced from 10.0