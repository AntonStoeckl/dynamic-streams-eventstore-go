## Librarian BooksLentOut Behavior Enhancement  
- **Created**: 2025-08-19 04:45
- **Priority**: Medium
- **Objective**: Implement realistic librarian behavior with overdue book management

## Problem Description

Current librarians only add/remove books from circulation randomly. Real librarians proactively manage overdue books, check lending patterns, and handle problematic loans - activities that would create more realistic library simulation behavior.

## Solution Overview

Make librarian actors call `QueryBooksLentOut` periodically to find overdue books and implement realistic library management workflows.

### Core Features
- **Overdue book detection**: Find books lent >14 days ago
- **Librarian work patterns**: Structured overdue checks vs random book management  
- **Proactive management**: Realistic librarian decision-making
- **Business metrics**: Track librarian effectiveness and library health

## Implementation Plan

### Phase 1: Overdue Detection Logic
1. **Add overdue threshold configuration** to `tuning.go`:
   ```go
   OverdueThresholdDays = 14 // Books overdue after 2 weeks
   ```

2. **Implement overdue detection** in LibrarianActor:
   ```go
   func (l *LibrarianActor) findOverdueBooks(ctx context.Context) []OverdueBook {
       lentBooks := QueryBooksLentOut(ctx)
       // Filter books lent > OverdueThresholdDays ago
   }
   ```

### Phase 2: Librarian Work Scheduling
1. **Modify librarian behavior** in `actors.go`:
   - 70% chance: Check for overdue books (realistic priority)
   - 20% chance: Add books to circulation  
   - 10% chance: Remove books from circulation

2. **Add overdue management actions**:
   - Log overdue books for monitoring
   - Generate overdue statistics
   - Future: Send overdue notifications (simulation of real workflow)

### Phase 3: Enhanced Metrics
1. **Add librarian effectiveness metrics**:
   - Number of overdue books detected
   - Average overdue duration
   - Collection health statistics

2. **Integration with existing monitoring**:
   - Add to Grafana dashboards
   - Include in simulation performance reports

## Technical Details

### Files to Modify
- **`actors.go`**: LibrarianActor behavior enhancement
- **`scheduler.go`**: Librarian work scheduling updates
- **`tuning.go`**: Add overdue threshold configuration
- **`handlers.go`**: Ensure BooksLentOut queries work efficiently

### Data Structures
```go
type OverdueBook struct {
    BookID      uuid.UUID
    ReaderID    uuid.UUID  
    LentDate    time.Time
    DaysOverdue int
}

type LibrarianStats struct {
    OverdueBooksFound   int
    AverageOverdueDays  float64
    CollectionHealth    float64 // Percentage of books not overdue
}
```

### Performance Considerations
- **Query efficiency**: BooksLentOut query is already optimized
- **Frequency**: Librarians work less frequently than readers (by design)
- **Impact**: Minimal performance overhead, adds realistic business behavior

## Expected Benefits

### Simulation Realism
- **Realistic workflows**: Matches actual library staff priorities
- **Business behavior**: More authentic library management simulation
- **Data patterns**: Overdue book statistics reflect real library challenges

### System Validation  
- **Query handler usage**: BooksLentOut gets realistic usage patterns
- **Performance testing**: Validates system under librarian query loads
- **Monitoring**: Enhanced metrics for system health

## Success Criteria

- ✅ Librarians detect overdue books using BooksLentOut queries
- ✅ Configurable overdue thresholds (14 days default)
- ✅ Realistic work pattern: 70% overdue management, 30% collection management
- ✅ Enhanced simulation metrics showing library health statistics
- ✅ Grafana dashboards display librarian activity and overdue book trends
- ✅ No performance impact on reader actor operations

## Future Extensions

- **Overdue notifications**: Simulate sending notices to readers
- **Fine calculations**: Model late fees and financial aspects
- **Collection analysis**: Advanced analytics on book popularity and circulation patterns
- **Multi-librarian coordination**: Different librarian types with specialized roles