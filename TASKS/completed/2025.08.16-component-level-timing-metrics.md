## Component-Level Timing Metrics Implementation
- **Created**: 2025-08-16 17:45
- **Started**: 2025-08-16 17:45
- **Completed**: 2025-08-16 19:30
- **Priority**: High
- **Objective**: Add component-level timing metrics to Grafana panels for Command/Query Component Timing Breakdown

## üéØ Background
Grafana dashboard has panels expecting these metrics but no data shows because component-level timing isn't implemented:
- `commandhandler_component_duration_seconds` with labels: `command_type`, `component`, `status`
- `queryhandler_component_duration_seconds` with labels: `query_type`, `component`, `status`

Current handlers only track total duration, not individual phases.

## üìä Metrics to Implement

### Command Handlers - Track timing for:
- **Query Phase** - EventStore.Query execution time
- **Unmarshal Phase** - DomainEventsFrom deserialization time  
- **Decide Phase** - Business logic execution time
- **Append Phase** - EventStore.Append execution time

### Query Handlers - Track timing for:
- **Query Phase** - EventStore.Query execution time
- **Unmarshal Phase** - DomainEventsFrom deserialization time
- **Projection Phase** - Business logic execution time

## üõ†Ô∏è Implementation Steps

### ‚úÖ Step 1: Add Metrics Infrastructure - COMPLETED
- [x] Add `CommandHandlerComponentDurationMetric` constant
- [x] Add `QueryHandlerComponentDurationMetric` constant  
- [x] Add `RecordCommandComponentDuration()` helper function
- [x] Add `RecordQueryComponentDuration()` helper function
- [x] Define component name constants

### ‚úÖ Step 2: Update Command Handlers (6 files) - COMPLETED
- [x] addbookcopy/command_handler.go
- [x] cancelreadercontract/command_handler.go
- [x] lendbookcopytoreader/command_handler.go
- [x] registerreader/command_handler.go
- [x] removebookcopy/command_handler.go
- [x] returnbookcopyfromreader/command_handler.go

For each: ‚úÖ Added timers around Query, Unmarshal, Decide, and Append phases

### ‚úÖ Step 3: Update Query Handlers (4 files) - COMPLETED
- [x] bookslentbyreader/query_handler.go
- [x] bookslentout/query_handler.go
- [x] booksincirculation/query_handler.go
- [x] registeredreaders/query_handler.go

For each: ‚úÖ Added timers around Query, Unmarshal, and Projection phases

### üîÑ Step 4: Test Implementation - IN PROGRESS
- [ ] Run simulation to verify metrics collection
- [ ] Check Grafana panels show component timing breakdown
- [ ] Validate timing measurements are reasonable

## üéØ Expected Benefits
- **Performance visibility**: Identify bottlenecks in specific phases
- **Optimization guidance**: Focus optimization efforts on slowest components
- **Debugging support**: Understand which phase causes performance issues
- **Grafana panels**: Finally show data in Component Timing Breakdown panels